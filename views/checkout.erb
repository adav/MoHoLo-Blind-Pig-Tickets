<h1  class="harryp" style="color:white">Moishe House</h1>
<h2  class="harryp" style="color:white">and the Deathly Halloween</h2>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script src="https://checkout.stripe.com/checkout.js"></script>

<form class="pure-form">
  Quantity: <select id="quantity">
      <option>1</option>
      <option>2</option>
      <option>3</option>
      <option>4</option>
      <option>5</option>
      <option>6</option>
  </select>
  Your Full Name: <input type="text" id="fullname" />
  <button id="buyButton" class="pure-button pure-button-primary button-large">Buy Tickets</button>
</form>

<script>
  var handler = StripeCheckout.configure({
    key: '<%= settings.publishable_key %>',
    image: '/img/mlogo.png',
    token: function(token) {
     $.ajax({
          url: '/pay',
          type: 'POST',
          data: {
              stripeToken: token.id,
              stripeEmail: token.email,
              quantity: Number(document.getElementById("quantity").value)
          },
          success: function(response){
            window.location.href = '/seeyousoon' ;
          }
      });
    }
  });

  $('#buyButton').on('click', function(e) {
    var quantity = Number(document.getElementById("quantity").value);
    handler.open({
      name: '<%= settings.ticket_name %>',
      description: quantity + 'x Ticket',
      currency: "gbp",
      zipCode: true,
      allowRememberMe: false,
      amount: quantity * <%= settings.ticket_price %>
    });
    e.preventDefault();
  });

  $(window).on('popstate', function() {
    handler.close();
  });
</script>
